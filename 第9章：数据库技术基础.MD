## 数据库技术基础

### 9.1基本概念
数据库系统（DataBase System）是一个采用了数据库技术，有组织地、动态地存储大量数据，方便多用户访问的计算机系统  
数据库（DataBase）是统一管理的、长期存储在计算机内的、有组织的相关数据的集合，特点是数据间联系密切、冗余度小、独立性高、易扩展，可为各类用户共享  
数据库管理系统（DataBase Management System）主要实现对共享数据有效地组织、管理和存取，具有以下六方面功能：  

1. 数据定义：对数据库的结构进行描述，包括外模式、模式、内模式的定义
2. 数据库操作：增删改查
3. 数据库运行管理：并发控制、事务管理、自动恢复等
4. 数据的组织、存储和管理
5. 数据库的建立和维护：数据转换、转存、恢复、重组重构、性能监测分析等
6. 其他：网络通信，文件系统数据转换

#### 数据库管理系统的特征及分类
特征：

1. 数据结构化且统一管理
2. 有较高的数据独立性
3. 数据控制功能：数据库的安全性、完整性、并发控制、故障恢复

分类：

1. 关系数据库系统：
2. 面向对象的数据库系统：支持以对象形式对数据建模的数据库管理系统
3. 对象关系数据库系统：在传统的关系数据模型基础上提供元组、数组、集合等丰富的数据类型及处理新的数据类型操作的能力  

体系结构：

1. 集中式数据库系统
2. 客户端/服务器结构：客户端的请求被送到服务器上执行
3. 并行数据库系统：多个物理上连在一起的CPU（相对于分布式系统是多个地理上分开的CPU）
4. 分布式数据库系统：分为物理上分布、逻辑上集中的分布式数据库结构和物理上分布、逻辑上分布的分布式数据库结构两种  

#### 数据库的三级模式结构

1. 概念模式：它是数据库中全部数据的逻辑结构和特征的描述
2. 外模式：是用户与数据库系统的接口，是用户用到的那部分数据的描述
3. 内模式：是数据物理结构和存储方式的描述，是数据在数据库内部的表示方式，定义所有的内部记录类型、索引和文件的组织方式以及数据控制方面的细节  

#### 大数据
大数据是指“无法用现有的软件工具提取、存储、搜索、共享、分析和处理海量的、复杂的数据集合”  
由于互联网技术的发展，用户在线的每一次点击、评论、搜索、点播，都是大数据的典型来源  
特征：体量巨大、数据类型繁多、价值密度高低与数据总量大小成反比（以视频为例，一部一小时的监控视频，有价值的可能就一两秒）、处理速度快

安全风险：

1. 大数据成为网络攻击的显著目标
2. 加大了隐私泄露风险
3. 威胁现有的存储和安防措施
4. 大数据技术成为黑客的攻击手段，利用大数据搜集用户信息使黑客的攻击更加精准
5. 成为高级可持续攻击的载体

### 9.2数据模型
三要素：

1. 数据结构：所研究的对象类型的集合
2. 数据操作：对数据库中各种对象的实例（值）运行执行的操作（如增删改查）
3. 数据约束条件：对具体应用数据必须遵循特定的语义约束条件，如某单位要求在职的职工年龄必须在18-60岁之间

#### E-R模型
按用户的观点对数据和信息建模

1. 实体：实体是现实世界中可以区别于其他对象的“事件”或“物体”，E-R模型中用矩形表示
2. 联系：实体与实体间有三种联系，一对一、一对多、多对多，E-R模型中用菱形表示
3. 属性：属性是实体某方面的特性

### 9.3 关系代数
现实世界中，描述事物常取若干特征来表示，这些特征称为属性  
一个属性值的值的集合，称为该属性的域  

第一范式：关系数据模型中，所有域都是原子数据（整数、字符串是原子数据，集合、记录、数组是非原子数据）  

笛卡儿积D1 * D2 * D3，等于D1中的每一个分量分别与D2、D3中的每一个分量相乘

元组：上面的D1/D2/D3的每一行元素组成一个元组

#### 5种基本的关系代数运算

1. 并（Union）R U S，即取两个关系的并集
2. 差（Difference）R - S，取两个关系的差
3. 广义笛卡儿积 R * S，和笛卡儿积一样
4. 投影，π A,C(R)，在R关系中取A、C列
5. 选择，σ A > B(R)，取R关系中，第A个属性值大于第B个属性值的元组，A > '4'(R)，表示选取R关系中第A个属性值大于4的元组

#### 扩展的关系代数运算

1. 交，R ∩ S，取两个关系的交集
2. 连接（Join），R ⋈ S，从R,S的笛卡儿积中选择满足一定条件的元组，可以认为笛卡儿积是无条件连接
	* 自然连接，是一种特殊的等值连接，要求两个关系中进行比较的分量必须是相同的属性组（如R和S的第A列第一个分量都等于a，第C列第一个分量都等于c），并且在结果集中将重复属性列去掉。
3. 除，R / S，找出R中与S同属性组且同属性值的属性组，去掉S的列，若R中有多个属性组与S同属性且同属性值，取最后一个    
4. 广义投影，和投影类似，但允许在投影列表中使用算术运算，π F1,F2(R), F1,F2为条件
5. 外连接，是连接运算的扩展，可以处理由于连接运算而缺失的信息
	* 左外连接：取出左侧关系中所有与右侧关系中任一元素都不匹配的元组，用空值null填充所有来自右侧关系的属性，构成新的元组并加入自然连接的结果中  
	* 右外连接：和左外连接相反  
	* 全外连接：完成左外连接和右外连接的操作

### 关系数据库SQL简介

SQL语言支持关系数据库的三级模式结构，视图对应外模式、基本表对应模式、存储文件对应内模式  

1. 创建表：CREATE TABLE 表名 (列名 数据类型 列级完整性约束条件,列名 数据类型 列级完整性约束条件)，约束条件有NULL（空）和UNIQUE（取值唯一），可以组合，如：NOT NULL UNIQUE 表示取值唯一，不能为空
2. 修改和删除表：
	* 修改表：ALTER TABLE 表名 [ADD 新列名 数据类型 [约束条件]]  
							[DROP 完整性约束名]
							[MODIFY 列名 数据类型];
	* 删除表：DROP TABLE 表名
3. 建立索引：CREATE [UNIQUE][CLUSTER]INDEX 索引名
				ON 表名(列名 [次序(正序倒序的意思)]， 列名 [次序]);
	删除索引：DROP INDEX 索引名


#### 索引的建立与删除

索引的作用如下：  
1. 通过创建唯一索引，可以保证数据记录的唯一性  
2. 可以大大加快数据检索速度  
3. 可以加速表与表之间的连接
4. 在使用ORDER BY 和 GROUP BY子句中进行检索数据时，可以显著减少查询中分组和排序的时间  
5. 使用索引可以在检索数据的过程中使用优化隐藏器，提高系统性能  

#### SQL数据查询

SELECT基本结构  
SELECT [ALL | DISTINCT]目标表达式[,目标表达式]
	FROM 表名或视图名[,表名或视图名]
	GROUP BY 列名 [HAVING 条件表达式]
	ORDER BY 列名 [ASC正序 | DESC倒序]  

别名：old-name AS new-name, AS子句可以出现在SELECT子句，也可以出现在FROM子句  
SELECT name AS 姓名, Age AS 年龄 FROM 表名  

连接查询：查询涉及两个及以上的表，称为连接查询  
子查询：查询里嵌套另一个查询  
聚集函数：输入一个集合，返回一个值，如求和、平均值、最大值等  
分组查询：将查询结果分组  
更名运算：就是别名而已，SELECT name AS 姓名, age AS 年龄 from 表名  
字符串匹配：%匹配任意字符串，_匹配任意单个字符，大小写敏感

#### SQL 数据更新  
1. 插入
INSERT INTO 表名 (字段名[,字段名])
	VALUES(常量[,常量])

INSERT INTO 表名
	SELECT 查询语句

2. 删除
DELETE FROM 表名
[WHERE 条件表达式]

3. 修改
UPDATE 表名
SET 列名=值
[WHERE 条件表达式]

#### SQL授权
授权：GRANT 权限+ [ON 对象类型 对象名] TO 用户+
收回授权：REVOKE 权限+ [ON 对象类型 对象名] TO 用户+

### 9.5 关系数据库的规范化

先要知道几个概念：完全函数依赖、部分函数依赖、传递函数依赖、码、主属性、非主属性  

x、y是属性或属性组：

完全函数依赖：如果x->y，根据x的全部属性才能得到y，根据x的部分属性无法得到y。比如x=(学号、课程)，y=分数，必须用学号和课程才能得到分数  

部分函数依赖：如果x->y，根据x的部分属性就能得到y。比如x=（学号，课程），y=姓名，只需要学号就能得到姓名  

传递函数依赖：如果x->y，y->z,则x->z，这就是传递依赖  

码：k是表中的一个属性或属性组，如果在k确定的情况下，其它属性也都随之确定，k就是候选码，简称码，也叫主键  

主属性：包含在任意码中的属性就叫主属性  

非主属性：主属性之外的属性  

1NF（第一范式）：若关系模式R的每一个分量（字段）是不可再分的数据项，则关系模式R属于第一范式  
2NF（第二范式）：满足1NF，且表中的字段必须完全依赖于全部主键而非部分主键      
3NF（第三范式）：满足2NF，且消除了非主属性对于码的传递函数依赖  

[数据库第一二三范式到底在说什么？ ](https://zhuanlan.zhihu.com/p/20028672)  

### 9.6 数据库的控制功能  

#### 事务：要么不做，要么做完  

1. BEGIN TRANSACTION 事务开始  
2. COMMIT 事务提交，表示事务成功结束
3. ROLLBACK 事务回滚，表示事务失败，该事务的所有更新都必须回滚或撤销  

并发操作带来的问题：

1. 丢失修改，两个事务同时修改数据A，但保存到数据库的时间不一致  
2. 不可重复读，事务读取AB的值在运算过程中，另一个事务改动了A或B的值
3. 读脏数据，事务T1修改了数据A，之后事务T2读取了修改后的值，然后事务T1回滚了

解决以上问题，从保证事务隔离性入手

1. 排他锁，只能指定单个事务读写数据A
2. 共享锁，任意事务都可以读但是不能写 

